name: Python Build & Deploy

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ§¾ Checkout du code
        uses: actions/checkout@v4

      - name: ğŸ—ï¸ CrÃ©ation du dossier build
        run: mkdir -p build

      - name: ğŸ“‚ Copier les fichiers Python dans build/
        run: |
          cp hashgestion.py build/
          cp aesgestion.py build/
          cp rsagestion.py build/
          echo "âœ… Fichiers copiÃ©s dans build/"

      - name: ğŸ§ª VÃ©rification de la prÃ©sence des fichiers
        run: |
          ls -la build/
          test -f build/hashgestion.py
          test -f build/aesgestion.py
          test -f build/rsagestion.py
          echo "âœ… Tous les fichiers sont prÃ©sents dans build/"

      - name: ğŸ“¦ Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: build_artifacts
          path: build/
          retention-days: 7

  deploy:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ TÃ©lÃ©charger les artefacts du build
        uses: actions/download-artifact@v4
        with:
          name: build_artifacts
          path: build/

      - name: ğŸ§¾ VÃ©rifier les fichiers tÃ©lÃ©chargÃ©s
        run: |
          echo "Liste des fichiers dans build/"
          ls -la build/

      - name: ğŸ—‚ï¸ CrÃ©er le dossier deploy
        run: mkdir -p deploy

      - name: ğŸš€ Copier les fichiers vers deploy/
        run: |
          cp build/*.py deploy/
          echo "âœ… Fichiers copiÃ©s dans deploy/"

      - name: ğŸ“¦ Upload deploy artifacts
        uses: actions/upload-artifact@v4
        with:
          name: deploy_artifacts
          path: deploy/
          retention-days: 14

      # (Optionnel) Ã‰tape de dÃ©ploiement rÃ©el
      # - name: ğŸš€ DÃ©ploiement sur le serveur / cloud / etc.
      #   run: |
      #     echo "DÃ©ploiement en cours..."
      #     # exemple : scp -r deploy/* user@serveur:/var/www/app
      #     echo "âœ… DÃ©ploiement terminÃ© !"
